<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Wildfire Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: black;
        }
        .sidebar {
            width: 60px;
            background-color: black;
        }
        .map-container {
            flex: 1;
            background-color: white;
            display: flex;
            flex-direction: column;
        }
        #map {
            flex: 1;
        }
    </style>
</head>
<body>

<div class="sidebar"></div>
<div class="map-container">
    <div id="map"></div>
</div>
<div class="sidebar"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize Leaflet map
    const map = L.map('map').setView([20, 0], 2);

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Try multiple approaches to load fire data
    const CORS_PROXY_1 = 'https://corsproxy.io/?';
    const CORS_PROXY_2 = 'https://api.allorigins.win/raw?url=';
    const FIRMS_URL = 'https://firms.modaps.eosdis.nasa.gov/data/active_fire/viirs/geojson/Global_VIIRS_C2_24h.geojson';
    
    // Alternative: Use a different fire data source that's CORS-friendly
    const ALTERNATIVE_URL = 'https://services9.arcgis.com/RHVPKKiFTONKtxq3/arcgis/rest/services/MODIS_Thermal_v1/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson';

    let fireLayer;

    async function loadFireData() {
        try {
            console.log('Fetching fire data...');
            
            // Try the alternative ESRI ArcGIS service first (more CORS-friendly)
            let res = await fetch(ALTERNATIVE_URL);
            if (!res.ok) {
                console.log('Alternative source failed, trying CORS proxy...');
                // If that fails, try with CORS proxy
                const PROXIED_URL = CORS_PROXY_1 + encodeURIComponent(FIRMS_URL);
                res = await fetch(PROXIED_URL);
            }
            
            if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
            const data = await res.json();

            // Remove previous layer if it exists
            if (fireLayer) {
                map.removeLayer(fireLayer);
            }

            fireLayer = L.geoJSON(data, {
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, {
                        radius: 5,
                        fillColor: "red",
                        color: "darkred",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    });
                },
                onEachFeature: function (feature, layer) {
                    let info = `<strong>Fire Detection</strong><br>
                                Brightness: ${feature.properties.brightness || 'N/A'}<br>
                                Date: ${feature.properties.acq_date || 'N/A'}<br>
                                Time: ${feature.properties.acq_time || 'N/A'} UTC`;
                    layer.bindPopup(info);
                }
            }).addTo(map);

            console.log(`Fire data updated: ${new Date().toLocaleTimeString()}`);

        } catch (err) {
            console.error('Failed to load fire data:', err);
        }
    }

    // Load data initially
    loadFireData();

    // Auto-refresh every 15 minutes (900000 ms)
    setInterval(loadFireData, 900000);
</script>

</body>
</html>
